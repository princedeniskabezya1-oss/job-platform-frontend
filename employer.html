<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AIFT Employer Dashboard</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

<style>
:root{
  --primary:#0a66c2;
  --primary-light:#e8f3ff;
  --bg:#f3f2ef;
  --card:#ffffff;
  --text:#1c1c1c;
  --muted:#6f6f6f;
  --border:#e0e0e0;
  --danger:#d93025;
  --success:#1e8e3e;
}

*{
  margin:0;
  padding:0;
  box-sizing:border-box;
  font-family:'Inter',sans-serif;
}

body{
  background:var(--bg);
  color:var(--text);
}

/* ================= HEADER ================= */
.header{
  background:white;
  padding:15px 40px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  box-shadow:0 2px 8px rgba(0,0,0,0.05);
  position:sticky;
  top:0;
  z-index:100;
}

.logo{
  font-weight:800;
  font-size:22px;
}
.logo span{color:var(--primary);}

.header-actions button{
  margin-left:10px;
}

/* ================= LAYOUT ================= */
.layout{
  display:grid;
  grid-template-columns:260px 1fr;
  gap:20px;
  max-width:1400px;
  margin:30px auto;
}

/* ================= SIDEBAR ================= */
.sidebar{
  background:white;
  border-radius:12px;
  padding:20px;
  box-shadow:0 4px 15px rgba(0,0,0,0.05);
  height:fit-content;
}

.sidebar h3{
  margin-bottom:15px;
}

.nav-item{
  padding:12px;
  border-radius:8px;
  cursor:pointer;
  margin-bottom:6px;
  font-size:14px;
}

.nav-item:hover{
  background:var(--primary-light);
  color:var(--primary);
}

.nav-item.active{
  background:var(--primary-light);
  color:var(--primary);
  font-weight:600;
}

/* ================= MAIN CONTENT ================= */
.main{
  display:grid;
  grid-template-columns:1fr 320px;
  gap:20px;
}

/* ================= CARDS ================= */
.card{
  background:white;
  padding:20px;
  border-radius:12px;
  box-shadow:0 4px 15px rgba(0,0,0,0.05);
  margin-bottom:20px;
}

/* ================= PROFILE CARD ================= */
.banner{
  width:100%;
  height:120px;
  background:#ddd;
  border-radius:10px;
  object-fit:cover;
}

.profile-img{
  width:90px;
  height:90px;
  border-radius:50%;
  border:4px solid white;
  margin-top:-45px;
  object-fit:cover;
}

/* ================= POST BOX ================= */
.post-box textarea{
  width:100%;
  border:none;
  resize:none;
  outline:none;
  font-size:15px;
}

.post-actions{
  display:flex;
  justify-content:space-between;
  margin-top:10px;
}

button{
  background:var(--primary);
  color:white;
  border:none;
  padding:8px 16px;
  border-radius:20px;
  cursor:pointer;
  font-weight:600;
}

button.secondary{
  background:#eee;
  color:#333;
}

/* ================= POSTS ================= */
.post-media img,
.post-media video{
  width:100%;
  border-radius:10px;
  margin-top:10px;
}

.post-footer{
  display:flex;
  justify-content:space-between;
  margin-top:10px;
  font-size:14px;
  color:var(--muted);
}

.action-btn{
  cursor:pointer;
  display:flex;
  align-items:center;
  gap:6px;
}

.action-btn:hover{
  color:var(--primary);
}

/* ================= JOBS ================= */
.job-row{
  padding:12px 0;
  border-bottom:1px solid var(--border);
  font-size:14px;
}

/* ================= RIGHT STATS ================= */
.stat{
  margin-bottom:10px;
  font-size:14px;
}
.stat b{
  color:var(--text);
}
</style>
</head>

<body>

<div class="header">
  <div class="logo"><span>AI</span>FT Employer</div>
  <div class="header-actions">
    <button onclick="window.location.href='profile.html'">Profile</button>
    <button onclick="logout()">Logout</button>
  </div>
</div>

<div class="layout">

  <!-- SIDEBAR -->
  <div class="sidebar">
    <h3>Employer Panel</h3>
    <div class="nav-item active" onclick="switchTab('feed')">Feed</div>
    <div class="nav-item" onclick="switchTab('jobs')">My Jobs</div>
    <div class="nav-item" onclick="switchTab('applications')">Applications</div>
    <div class="nav-item" onclick="switchTab('analytics')">Analytics</div>
  </div>

  <!-- MAIN -->
  <div class="main">

    <!-- CENTER -->
    <div id="centerContent"></div>

    <!-- RIGHT -->
    <div>
      <div class="card" id="profileCard"></div>
      <div class="card" id="statsCard"></div>
    </div>

  </div>

</div>

<script>
const API="https://backend-1-9b6f.onrender.com";
const token=localStorage.getItem("token");
if(!token) window.location.href="login.html";

let currentTab="feed";

/* ================= SWITCH TABS ================= */
function switchTab(tab){
  currentTab=tab;
  document.querySelectorAll(".nav-item").forEach(n=>n.classList.remove("active"));
  event.target.classList.add("active");
  renderTab();
}

/* ================= RENDER TAB ================= */
function renderTab(){
  if(currentTab==="feed") renderFeed();
  if(currentTab==="jobs") renderJobs();
  if(currentTab==="applications") renderApplications();
  if(currentTab==="analytics") renderAnalytics();
}

/* ================= PROFILE ================= */
async function loadProfile(){
  const res=await fetch(API+"/api/users/me",{headers:{Authorization:"Bearer "+token}});
  const user=await res.json();

  document.getElementById("profileCard").innerHTML=`
    <img class="banner" src="${user.bannerImage||''}">
    <img class="profile-img" src="${user.profileImage||'https://cdn-icons-png.flaticon.com/512/149/149071.png'}">
    <h3>${user.name}</h3>
    <div style="color:#6f6f6f;font-size:14px;">${user.headline||''}</div>
  `;

  document.getElementById("statsCard").innerHTML=`
    <h3>Stats</h3>
    <div class="stat">Followers: <b>${user.followers?.length||0}</b></div>
    <div class="stat">Following: <b>${user.following?.length||0}</b></div>
    <div class="stat">Pro Status: <b>${user.isPro?"Pro":"Free"}</b></div>
  `;
}

/* ================= FEED ================= */
async function renderFeed(){
  const res=await fetch(API+"/api/posts");
  const posts=await res.json();

  let html=`
    <div class="card post-box">
      <textarea id="postContent" rows="3" placeholder="Share company update..."></textarea>
      <div class="post-actions">
        <input type="file" id="mediaInput" accept="image/*,video/*">
        <button onclick="createPost()">Post</button>
      </div>
    </div>
  `;

  posts.forEach(post=>{
    html+=`
      <div class="card">
        <b>${post.author?.name||''}</b>
        <div>${post.content||''}</div>
        ${post.mediaUrl?`
          <div class="post-media">
            ${post.mediaType==="video"
              ? `<video controls src="${post.mediaUrl}"></video>`
              : `<img src="${post.mediaUrl}">`}
          </div>`:''}
        <div class="post-footer">
          <div>${post.likes.length} Likes</div>
          <div class="action-btn" onclick="likePost('${post._id}')">❤️ Like</div>
        </div>
      </div>
    `;
  });

  document.getElementById("centerContent").innerHTML=html;
}

/* ================= JOBS ================= */
async function renderJobs(){
  const res=await fetch(API+"/api/jobs/my",{headers:{Authorization:"Bearer "+token}});
  const jobs=res.ok?await res.json():[];

  let html=`<div class="card"><h3>My Jobs</h3>`;

  jobs.forEach(job=>{
    html+=`
      <div class="job-row">
        <b>${job.title}</b> — ${job.status}
      </div>
    `;
  });

  html+=`</div>`;
  document.getElementById("centerContent").innerHTML=html;
}

/* ================= APPLICATIONS ================= */
async function renderApplications(){
  const res=await fetch(API+"/api/applications",{headers:{Authorization:"Bearer "+token}});
  const apps=res.ok?await res.json():[];

  let html=`<div class="card"><h3>Applications</h3>`;

  apps.forEach(app=>{
    html+=`
      <div class="job-row">
        <b>${app.name}</b> applied for ${app.jobId?.title||''}
      </div>
    `;
  });

  html+=`</div>`;
  document.getElementById("centerContent").innerHTML=html;
}

/* ================= ANALYTICS ================= */
async function renderAnalytics(){
  const jobsRes=await fetch(API+"/api/jobs/my",{headers:{Authorization:"Bearer "+token}});
  const jobs=jobsRes.ok?await jobsRes.json():[];

  const appsRes=await fetch(API+"/api/applications",{headers:{Authorization:"Bearer "+token}});
  const apps=appsRes.ok?await appsRes.json():[];

  document.getElementById("centerContent").innerHTML=`
    <div class="card">
      <h3>Analytics Overview</h3>
      <p>Total Jobs: ${jobs.length}</p>
      <p>Active Jobs: ${jobs.filter(j=>j.status==="active").length}</p>
      <p>Total Applications: ${apps.length}</p>
    </div>
  `;
}

/* ================= CREATE POST ================= */
async function createPost(){
  const content=document.getElementById("postContent").value;
  const file=document.getElementById("mediaInput").files[0];
  const formData=new FormData();
  formData.append("content",content);
  if(file) formData.append("media",file);

  const res=await fetch(API+"/api/posts",{
    method:"POST",
    headers:{Authorization:"Bearer "+token},
    body:formData
  });

  if(res.status===403){
    alert("Upgrade to Pro to post media");
    return;
  }

  renderFeed();
}

/* ================= LIKE ================= */
async function likePost(id){
  await fetch(API+"/api/posts/"+id+"/like",{
    method:"PATCH",
    headers:{Authorization:"Bearer "+token}
  });
  renderFeed();
}

function logout(){
  localStorage.removeItem("token");
  window.location.href="login.html";
}

loadProfile();
renderTab();
</script>

</body>
</html>
