<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Employer Dashboard | AIFT</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
:root{
  --linkedin-blue:#0a66c2;
  --bg:#f3f2ef;
  --card:#ffffff;
  --text:#1c1c1c;
  --muted:#6f6f6f;
}

*{margin:0;padding:0;box-sizing:border-box;font-family:'Inter',sans-serif;}
body{background:var(--bg);}

/* HEADER */
.header{
  background:white;
  padding:15px 40px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  box-shadow:0 2px 8px rgba(0,0,0,0.05);
}
.logo{font-weight:800;font-size:22px;}
.logo span{color:var(--linkedin-blue);}

button{
  background:var(--linkedin-blue);
  color:white;
  border:none;
  padding:8px 16px;
  border-radius:20px;
  cursor:pointer;
  font-weight:600;
}

/* LAYOUT */
.container{
  display:grid;
  grid-template-columns: 250px 1fr 300px;
  gap:20px;
  max-width:1200px;
  margin:40px auto;
}

/* CARDS */
.card{
  background:var(--card);
  padding:20px;
  border-radius:12px;
  box-shadow:0 4px 15px rgba(0,0,0,0.05);
  margin-bottom:20px;
}

/* PROFILE CARD */
.profile-card img{
  width:80px;
  height:80px;
  border-radius:50%;
  object-fit:cover;
  margin-bottom:10px;
}

.profile-card h3{margin-bottom:5px;}
.muted{color:var(--muted);font-size:14px;margin-bottom:5px;}

/* POST BOX */
.post-box textarea{
  width:100%;
  border:none;
  resize:none;
  font-size:15px;
  outline:none;
}

.post-actions{
  display:flex;
  justify-content:space-between;
  margin-top:15px;
}

/* POSTS */
.post-media img,
.post-media video{
  width:100%;
  border-radius:10px;
  margin-top:10px;
}

.post-footer{
  display:flex;
  justify-content:space-between;
  margin-top:10px;
  font-size:14px;
  color:var(--muted);
}

/* JOB LIST */
.job-item{
  border-bottom:1px solid #eee;
  padding:10px 0;
  font-size:14px;
}
</style>
</head>

<body>

<div class="header">
  <div class="logo"><span>AI</span>FT Employer</div>
  <div>
    <button onclick="window.location.href='profile.html'">Profile</button>
    <button onclick="logout()">Logout</button>
  </div>
</div>

<div class="container">

  <!-- LEFT COLUMN -->
  <div>

    <div class="card profile-card" id="profileCard"></div>

    <div class="card">
      <h3>Employer Tools</h3>
      <div class="job-item"><a href="post-job.html">Post a Job</a></div>
      <div class="job-item" onclick="loadMyJobs()">My Jobs</div>
      <div class="job-item" onclick="loadApplications()">Applications</div>
    </div>

  </div>

  <!-- CENTER COLUMN -->
  <div>

    <!-- CREATE POST -->
    <div class="card post-box">
      <textarea id="postContent" rows="3" placeholder="Share an update..."></textarea>
      <div class="post-actions">
        <input type="file" id="mediaInput" accept="image/*,video/*">
        <button onclick="createPost()">Post</button>
      </div>
    </div>

    <div id="posts"></div>

  </div>

  <!-- RIGHT COLUMN -->
  <div>

    <div class="card">
      <h3>Stats</h3>
      <div class="muted">Followers: <b id="followersCount">0</b></div>
      <div class="muted">Following: <b id="followingCount">0</b></div>
      <div class="muted">Pro Status: <b id="proStatus">Free</b></div>
    </div>

  </div>

</div>

<script>
const API="https://backend-1-9b6f.onrender.com";
const token=localStorage.getItem("token");
if(!token){window.location.href="login.html";}

/* ================= PROFILE ================= */
async function loadProfile(){
  const res = await fetch(API+"/api/users/me",{
    headers:{Authorization:"Bearer "+token}
  });
  const user = await res.json();

  document.getElementById("profileCard").innerHTML=`
    <img src="${user.profileImage || 'https://via.placeholder.com/80'}">
    <h3>${user.name}</h3>
    <div class="muted">${user.headline || ''}</div>
    <div class="muted">${user.companyName || ''}</div>
  `;

  document.getElementById("followersCount").innerText = user.followers?.length || 0;
  document.getElementById("followingCount").innerText = user.following?.length || 0;
  document.getElementById("proStatus").innerText = user.isPro ? "Pro" : "Free";
}

/* ================= POSTS ================= */
async function loadPosts(){

  const res = await fetch(API+"/api/posts",{
    headers:{ Authorization:"Bearer "+token }
  });

  if (!res.ok) {
  console.error("API error:", res.status);
  return;
}

const posts = await res.json();

  const container=document.getElementById("posts");
  container.innerHTML="";

  posts.forEach(post=>{
    container.innerHTML+=`
      <div class="card">

        <div style="display:flex;align-items:center;gap:10px;margin-bottom:10px;">
          <img src="${post.author?.profileImage || 'https://via.placeholder.com/40'}"
               style="width:40px;height:40px;border-radius:50%;object-fit:cover;">
          <div>
            <b>${post.author?.name || ''}</b>
            <div style="font-size:12px;color:#6f6f6f;">
              ${post.author?.headline || ''}
              ${post.author?.isPro ? " ¬∑ ‚≠ê Pro" : ""}
            </div>
          </div>
        </div>

        <div>${post.content || ''}</div>

        ${post.mediaUrl ? `
          <div class="post-media">
            ${post.mediaType==="video"
              ? `<video controls src="${post.mediaUrl}"></video>`
              : `<img src="${post.mediaUrl}">`}
          </div>
        ` : ''}

        <div class="post-footer">
          <div>${post.likes.length} Likes</div>
          <div style="cursor:pointer" onclick="likePost('${post._id}')">
            üëç Like
          </div>
        </div>

        <!-- COMMENT BOX -->
        <div style="margin-top:10px;">
          <input id="comment-${post._id}"
                 placeholder="Write a comment..."
                 style="width:100%;padding:8px;border-radius:20px;border:1px solid #ddd;">
          <button style="margin-top:5px"
                  onclick="addComment('${post._id}')">
            Comment
          </button>
        </div>

        <div style="margin-top:10px;">
          ${(post.comments || []).map(c=>`
            <div style="font-size:14px;margin-bottom:5px;">
              <b>${c.user?.name || "User"}:</b> ${c.text}
            </div>
          `).join("")}
        </div>

      </div>
    `;
  });
}


/* ================= CREATE POST ================= */
async function createPost(){
  const content=document.getElementById("postContent").value;
  const file=document.getElementById("mediaInput").files[0];

  const formData=new FormData();
  formData.append("content",content);
  if(file) formData.append("media",file);

  const res=await fetch(API+"/api/posts",{
    method:"POST",
    headers:{Authorization:"Bearer "+token},
    body:formData
  });

  if(res.status===403){
    alert("Only Pro users can post media");
    return;
  }

  document.getElementById("postContent").value="";
  document.getElementById("mediaInput").value="";
  loadPosts();
}

/* ================= LIKE ================= */
async function likePost(id){
  await fetch(API+"/api/posts/"+id+"/like",{
    method:"PATCH",
    headers:{Authorization:"Bearer "+token}
  });
  loadPosts();
}

/* ================= JOBS ================= */
async function loadMyJobs(){
  const res=await fetch(API+"/api/jobs/my",{
    headers:{Authorization:"Bearer "+token}
  });
  const jobs=await res.json();
  alert("You have "+jobs.length+" jobs posted.");
}

async function loadApplications(){
  const res=await fetch(API+"/api/applications",{
    headers:{Authorization:"Bearer "+token}
  });
  const apps=await res.json();
  alert("Total Applications: "+apps.length);
}

/* ================= LOGOUT ================= */
function logout(){
  localStorage.removeItem("token");
  window.location.href="login.html";
}

loadProfile();
loadPosts();
</script>

</body>
</html>
