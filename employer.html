<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Employer Feed | AIFT</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
:root{
  --linkedin-blue:#0a66c2;
  --bg:#f3f2ef;
  --card:#ffffff;
  --text:#1c1c1c;
  --muted:#6f6f6f;
}

*{
  margin:0;
  padding:0;
  box-sizing:border-box;
  font-family:'Inter',sans-serif;
}

body{
  background:var(--bg);
}

.header{
  background:white;
  padding:15px 40px;
  box-shadow:0 2px 8px rgba(0,0,0,0.05);
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.logo{
  font-weight:800;
  font-size:24px;
}

.logo span{
  color:var(--linkedin-blue);
}

.feed-container{
  max-width:700px;
  margin:40px auto;
}

.card{
  background:var(--card);
  padding:20px;
  border-radius:12px;
  margin-bottom:20px;
  box-shadow:0 4px 15px rgba(0,0,0,0.05);
}

.post-box textarea{
  width:100%;
  border:none;
  resize:none;
  font-size:15px;
  outline:none;
}

.post-actions{
  display:flex;
  justify-content:space-between;
  margin-top:15px;
}

button{
  background:var(--linkedin-blue);
  color:white;
  border:none;
  padding:8px 16px;
  border-radius:20px;
  cursor:pointer;
  font-weight:600;
}

button.secondary{
  background:#e4e6eb;
  color:#1c1c1c;
}

.post-header{
  font-weight:600;
  margin-bottom:10px;
}

.post-media{
  margin-top:15px;
  border-radius:10px;
  overflow:hidden;
}

.post-media img,
.post-media video{
  width:100%;
}

.post-footer{
  margin-top:15px;
  display:flex;
  justify-content:space-between;
  color:var(--muted);
  font-size:14px;
}

.comment-box{
  margin-top:10px;
  display:flex;
  gap:10px;
}

.comment-box input{
  flex:1;
  padding:8px;
  border-radius:20px;
  border:1px solid #ddd;
}

.comment{
  font-size:14px;
  margin-top:8px;
  color:#333;
}
</style>
</head>

<body>

<div class="header">
  <div class="logo"><span>AI</span>FT</div>
  <button onclick="logout()">Logout</button>
</div>

<div class="feed-container">

  <!-- CREATE POST -->
  <div class="card post-box">
    <textarea id="postContent" rows="3" placeholder="Start a post..."></textarea>

    <div class="post-actions">
      <div>
        <input type="file" id="mediaInput" accept="image/*,video/*">
      </div>
      <button onclick="createPost()">Post</button>
    </div>
  </div>

  <!-- POSTS WILL LOAD HERE -->
  <div id="posts"></div>

</div>

<script>
const API="https://backend-1-9b6f.onrender.com";
const token=localStorage.getItem("token");

if(!token){
  window.location.href="login.html";
}

async function loadPosts(){
  const res = await fetch(API+"/api/posts");
  const posts = await res.json();

  const container = document.getElementById("posts");
  container.innerHTML="";

  posts.forEach(post=>{
    container.innerHTML+=`
      <div class="card">
        <div class="post-header">${post.author?.name || "User"}</div>
        <div>${post.content || ""}</div>

        ${post.mediaUrl ? `
          <div class="post-media">
            ${post.mediaType==="video"
              ? `<video controls src="${post.mediaUrl}"></video>`
              : `<img src="${post.mediaUrl}" />`}
          </div>
        ` : ""}

        <div class="post-footer">
          <div>${post.likes.length} Likes</div>
          <div>
            <span onclick="likePost('${post._id}')">Like</span>
          </div>
        </div>

        <div class="comment-box">
          <input id="comment-${post._id}" placeholder="Write a comment...">
          <button class="secondary" onclick="addComment('${post._id}')">Send</button>
        </div>

        <div id="comments-${post._id}">
          ${(post.comments || []).map(c=>`
            <div class="comment"><b>${c.user?.name || ""}</b> ${c.text}</div>
          `).join("")}
        </div>

      </div>
    `;
  });
}

async function createPost(){
  const content = document.getElementById("postContent").value;
  const file = document.getElementById("mediaInput").files[0];

  const formData = new FormData();
  formData.append("content", content);
  if(file){
    formData.append("media", file);
  }

  const res = await fetch(API+"/api/posts",{
    method:"POST",
    headers:{
      Authorization:"Bearer "+token
    },
    body:formData
  });

  const data = await res.json();

  if(res.status===403){
    alert("Upgrade to Pro to post media");
    return;
  }

  document.getElementById("postContent").value="";
  document.getElementById("mediaInput").value="";
  loadPosts();
}

async function likePost(id){
  await fetch(API+"/api/posts/"+id+"/like",{
    method:"PATCH",
    headers:{ Authorization:"Bearer "+token }
  });
  loadPosts();
}

async function addComment(id){
  const text = document.getElementById("comment-"+id).value;

  await fetch(API+"/api/posts/"+id+"/comment",{
    method:"POST",
    headers:{
      "Content-Type":"application/json",
      Authorization:"Bearer "+token
    },
    body:JSON.stringify({text})
  });

  loadPosts();
}

function logout(){
  localStorage.removeItem("token");
  window.location.href="login.html";
}

loadPosts();
</script>

</body>
</html>
