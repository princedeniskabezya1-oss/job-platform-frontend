<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Employer Dashboard | AIFT</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
:root{
  --primary:#0a66c2;
  --bg:#f3f2ef;
  --card:#ffffff;
  --text:#1c1c1c;
  --muted:#6f6f6f;
  --border:#e0e0e0;
}

*{margin:0;padding:0;box-sizing:border-box;font-family:'Inter',sans-serif;}
body{background:var(--bg);}

/* HEADER */
.header{
  background:white;
  padding:15px 40px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  box-shadow:0 2px 8px rgba(0,0,0,0.05);
}
.logo{
  font-weight:800;
  font-size:22px;
}
.logo span{color:var(--primary);}
.header-buttons button{
  margin-left:10px;
}

/* BUTTON */
button{
  background:var(--primary);
  color:white;
  border:none;
  padding:8px 16px;
  border-radius:20px;
  cursor:pointer;
  font-weight:600;
}

/* LAYOUT */
.container{
  display:grid;
  grid-template-columns:260px 1fr 300px;
  gap:20px;
  max-width:1300px;
  margin:40px auto;
}

/* CARD */
.card{
  background:var(--card);
  padding:20px;
  border-radius:12px;
  box-shadow:0 4px 15px rgba(0,0,0,0.05);
  margin-bottom:20px;
}

/* PROFILE */
.profile-banner{
  width:100%;
  height:120px;
  background:#ddd;
  border-radius:10px;
  object-fit:cover;
}
.profile-image{
  width:90px;
  height:90px;
  border-radius:50%;
  border:4px solid white;
  margin-top:-45px;
  object-fit:cover;
}

/* TOOL LINKS */
.tool-link{
  padding:10px 0;
  border-bottom:1px solid var(--border);
  cursor:pointer;
  font-size:14px;
}
.tool-link:hover{color:var(--primary);}

/* POSTS */
.post-box textarea{
  width:100%;
  border:none;
  resize:none;
  outline:none;
  font-size:15px;
}

.post-media img,
.post-media video{
  width:100%;
  border-radius:10px;
  margin-top:10px;
}

.post-actions{
  display:flex;
  justify-content:space-between;
  margin-top:10px;
}

.post-footer{
  display:flex;
  justify-content:space-between;
  margin-top:10px;
  font-size:14px;
  color:var(--muted);
}

.icon-btn{
  cursor:pointer;
  display:flex;
  align-items:center;
  gap:6px;
}
.icon-btn:hover{color:var(--primary);}
.comment-box input{
  width:100%;
  padding:8px;
  border-radius:20px;
  border:1px solid var(--border);
  margin-top:8px;
}

/* RIGHT STATS */
.stat{
  margin-bottom:8px;
  font-size:14px;
}
.stat b{color:var(--text);}
</style>
</head>

<body>

<div class="header">
  <div class="logo"><span>AI</span>FT Employer</div>
  <div class="header-buttons">
    <button onclick="window.location.href='profile.html'">Profile</button>
    <button onclick="logout()">Logout</button>
  </div>
</div>

<div class="container">

<!-- LEFT COLUMN -->
<div>

  <div class="card" id="profileCard"></div>

  <div class="card">
    <h3>Employer Tools</h3>
    <div class="tool-link" onclick="window.location.href='post-job.html'">‚ûï Post New Job</div>
    <div class="tool-link" onclick="showMyJobs()">üìÑ My Jobs (<span id="jobCount">0</span>)</div>
    <div class="tool-link" onclick="showApplications()">üì© Applications (<span id="appCount">0</span>)</div>
  </div>

</div>

<!-- CENTER COLUMN -->
<div>

  <div class="card post-box">
    <textarea id="postContent" rows="3" placeholder="Share company update..."></textarea>
    <div class="post-actions">
      <input type="file" id="mediaInput" accept="image/*,video/*">
      <button onclick="createPost()">Post</button>
    </div>
  </div>

  <div id="posts"></div>

</div>

<!-- RIGHT COLUMN -->
<div>

  <div class="card">
    <h3>Company Stats</h3>
    <div class="stat">Followers: <b id="followers">0</b></div>
    <div class="stat">Following: <b id="following">0</b></div>
    <div class="stat">Pro Status: <b id="proStatus">Free</b></div>
    <hr style="margin:10px 0;">
    <div class="stat">Total Jobs: <b id="totalJobs">0</b></div>
    <div class="stat">Active Jobs: <b id="activeJobs">0</b></div>
    <div class="stat">Applications: <b id="totalApplications">0</b></div>
  </div>

</div>

</div>

<script>
const API="https://backend-1-9b6f.onrender.com";
const token=localStorage.getItem("token");
if(!token) window.location.href="login.html";

/* PROFILE */
async function loadProfile(){
  const res=await fetch(API+"/api/users/me",{headers:{Authorization:"Bearer "+token}});
  const user=await res.json();

  document.getElementById("profileCard").innerHTML=`
    <img class="profile-banner" src="${user.bannerImage || ''}">
    <img class="profile-image" src="${user.profileImage || 'https://cdn-icons-png.flaticon.com/512/149/149071.png'}">
    <h3>${user.name}</h3>
    <div style="color:#6f6f6f;font-size:14px;">${user.headline || ''}</div>
  `;

  document.getElementById("followers").innerText=user.followers?.length||0;
  document.getElementById("following").innerText=user.following?.length||0;
  document.getElementById("proStatus").innerText=user.isPro?"Pro":"Free";
}

/* POSTS */
async function loadPosts(){
  const res=await fetch(API+"/api/posts");
  const posts=await res.json();
  const container=document.getElementById("posts");
  container.innerHTML="";

  posts.forEach(post=>{
    container.innerHTML+=`
      <div class="card">
        <div><b>${post.author?.name||''}</b></div>
        <div>${post.content||''}</div>
        ${post.mediaUrl?`
          <div class="post-media">
            ${post.mediaType==="video"
              ? `<video controls src="${post.mediaUrl}"></video>`
              : `<img src="${post.mediaUrl}">`}
          </div>`:''}
        <div class="post-footer">
          <div>${post.likes.length} likes</div>
          <div class="icon-btn" onclick="likePost('${post._id}')">‚ù§Ô∏è Like</div>
        </div>
      </div>
    `;
  });
}

/* CREATE POST */
async function createPost(){
  const content=document.getElementById("postContent").value;
  const file=document.getElementById("mediaInput").files[0];
  const formData=new FormData();
  formData.append("content",content);
  if(file) formData.append("media",file);

  const res=await fetch(API+"/api/posts",{
    method:"POST",
    headers:{Authorization:"Bearer "+token},
    body:formData
  });

  if(res.status===403){alert("Upgrade to Pro to post media");return;}
  loadPosts();
}

/* LIKE */
async function likePost(id){
  await fetch(API+"/api/posts/"+id+"/like",{
    method:"PATCH",
    headers:{Authorization:"Bearer "+token}
  });
  loadPosts();
}

/* JOB STATS */
async function loadEmployerStats(){
  const jobsRes=await fetch(API+"/api/jobs/my",{headers:{Authorization:"Bearer "+token}});
  const jobs=jobsRes.ok?await jobsRes.json():[];
  document.getElementById("jobCount").innerText=jobs.length;
  document.getElementById("totalJobs").innerText=jobs.length;
  document.getElementById("activeJobs").innerText=jobs.filter(j=>j.status==="active").length;

  const appsRes=await fetch(API+"/api/applications",{headers:{Authorization:"Bearer "+token}});
  const apps=appsRes.ok?await appsRes.json():[];
  document.getElementById("appCount").innerText=apps.length;
  document.getElementById("totalApplications").innerText=apps.length;
}

function showMyJobs(){alert("Feature panel coming next step");}
function showApplications(){alert("Feature panel coming next step");}
function logout(){localStorage.removeItem("token");window.location.href="login.html";}

loadProfile();
loadPosts();
loadEmployerStats();
</script>

</body>
</html>
