<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>AIFT Profile</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Inter',sans-serif;}
body{background:#f3f2ef;color:#111;}
.layout{
display:grid;
grid-template-columns:300px 1fr 350px;
gap:25px;
max-width:1400px;
margin:40px auto;
padding:0 20px;
}

/* PANELS */
.panel{
background:white;
border-radius:12px;
box-shadow:0 4px 15px rgba(0,0,0,0.05);
padding:20px;
height:fit-content;
}

/* LEFT PANEL */
.avatar{
width:120px;height:120px;
border-radius:50%;
object-fit:cover;
margin-bottom:15px;
}
.name{
font-size:20px;
font-weight:600;
display:flex;
align-items:center;
gap:8px;
}
.verified{
background:#0a66c2;
color:white;
font-size:11px;
padding:3px 8px;
border-radius:20px;
}
.stat{
font-size:14px;
margin-top:8px;
}
.btn{
margin-top:15px;
padding:8px 18px;
border-radius:20px;
border:none;
font-weight:600;
cursor:pointer;
}
.follow{background:#0a66c2;color:white;}
.unfollow{background:#e4e6eb;}
.message{background:white;border:1px solid #ccc;}

/* CENTER GRID */
.posts-grid{
display:grid;
grid-template-columns:repeat(3,1fr);
gap:8px;
}
.post-item{
position:relative;
padding-top:100%;
overflow:hidden;
cursor:pointer;
border-radius:8px;
}
.post-item img,.post-item video{
position:absolute;top:0;left:0;
width:100%;height:100%;
object-fit:cover;
transition:.3s;
}
.post-item:hover img{transform:scale(1.05);}
.overlay{
position:absolute;
top:0;left:0;
width:100%;height:100%;
background:rgba(0,0,0,0.5);
color:white;
display:flex;
align-items:center;
justify-content:center;
opacity:0;
transition:.3s;
font-weight:600;
}
.post-item:hover .overlay{opacity:1;}

.like-heart{
position:absolute;
top:50%;left:50%;
transform:translate(-50%,-50%);
font-size:60px;
color:white;
opacity:0;
transition:.3s;
pointer-events:none;
}

/* RIGHT PANEL */
.section{margin-bottom:25px;}
.section h4{margin-bottom:10px;}
.skill{
background:#e4e6eb;
padding:6px 12px;
border-radius:20px;
margin:5px 5px 0 0;
display:inline-block;
font-size:13px;
}
.tool-btn{
display:block;
margin-top:8px;
padding:8px;
background:#f3f2ef;
border-radius:8px;
font-size:14px;
cursor:pointer;
transition:.3s;
}
.tool-btn:hover{background:#e4e6eb;}

/* MODAL */
.modal{
position:fixed;
top:0;left:0;
width:100%;height:100%;
background:rgba(0,0,0,0.85);
display:none;
align-items:center;
justify-content:center;
z-index:999;
}
.modal-content{
background:white;
max-width:800px;
width:90%;
border-radius:12px;
padding:20px;
}
.modal img,.modal video{width:100%;border-radius:10px;}
.close{cursor:pointer;text-align:right;font-weight:bold;margin-bottom:10px;}

@media(max-width:1200px){
.layout{grid-template-columns:1fr;}
}
</style>
</head>

<body>

<div class="layout">

<!-- LEFT PANEL -->
<div class="panel">
<img id="avatar" class="avatar">
<div class="name" id="name"></div>
<p id="headline"></p>

<div class="stat"><strong id="followers">0</strong> Followers</div>
<div class="stat"><strong id="following">0</strong> Following</div>

<button id="followBtn" class="btn follow" onclick="toggleFollow()">Follow</button>
<button class="btn message" onclick="messageUser()">Message</button>
</div>

<!-- CENTER PANEL -->
<div>
<div id="postsGrid" class="posts-grid"></div>
</div>

<!-- RIGHT PANEL -->
<div class="panel">

<div class="section">
<h4>Activity</h4>
<div id="activitySection"></div>
</div>

<div class="section">
<h4>Experience</h4>
<div id="experienceSection"></div>
</div>

<div class="section">
<h4>Education</h4>
<div id="educationSection"></div>
</div>

<div class="section">
<h4>Skills</h4>
<div id="skillsSection"></div>
</div>

<div class="section">
<h4>Employer Tools</h4>
<div id="toolsSection"></div>
</div>

</div>

</div>

<!-- MODAL -->
<div id="modal" class="modal">
<div class="modal-content">
<div class="close" onclick="closeModal()">X</div>
<div id="modalBody"></div>
</div>
</div>

<script>
const API="https://backend-1-9b6f.onrender.com";
const token=localStorage.getItem("token");
const params=new URLSearchParams(window.location.search);
const userId=params.get("id");

let profileUser=null;
let loggedUser=null;

/* LOAD PROFILE */
async function loadProfile(){
const res=await fetch(API+"/api/users/"+userId+"/public");
profileUser=await res.json();

document.getElementById("avatar").src=profileUser.profileImage||"https://cdn-icons-png.flaticon.com/512/149/149071.png";
document.getElementById("name").innerHTML=
profileUser.name+(profileUser.isPro?'<span class="verified">PRO</span>':"");
document.getElementById("headline").innerText=profileUser.headline||"";
document.getElementById("followers").innerText=profileUser.followers?.length||0;
document.getElementById("following").innerText=profileUser.following?.length||0;

/* EXPERIENCE */
const exp=document.getElementById("experienceSection");
(profileUser.experience||[]).forEach(e=>{
exp.innerHTML+=`<div><b>${e.title}</b> - ${e.company}</div>`;
});

/* EDUCATION */
const edu=document.getElementById("educationSection");
(profileUser.education||[]).forEach(e=>{
edu.innerHTML+=`<div><b>${e.school}</b> • ${e.degree}</div>`;
});

/* SKILLS */
const skills=document.getElementById("skillsSection");
(profileUser.skills||[]).forEach(s=>{
skills.innerHTML+=`<span class="skill">${s}</span>`;
});

/* ACTIVITY */
document.getElementById("activitySection").innerHTML=`
<div>Joined AIFT</div>
<div>${profileUser.followers?.length||0} followers</div>
`;

/* TOOLS */
if(token){
const meRes=await fetch(API+"/api/users/me",{headers:{Authorization:"Bearer "+token}});
loggedUser=await meRes.json();

if(loggedUser._id===userId){
document.getElementById("followBtn").style.display="none";
document.getElementById("toolsSection").innerHTML=`
<div class="tool-btn">Edit Profile</div>
<div class="tool-btn">Add Experience</div>
<div class="tool-btn">Add Education</div>
<div class="tool-btn">Upload Resume</div>
<div class="tool-btn">Manage Job Posts</div>
<div class="tool-btn">View Applicants</div>
`;
}
}
}

/* LOAD POSTS IG STYLE */
async function loadPosts(){
const res=await fetch(API+"/api/posts/user/"+userId);
const posts=await res.json();
const grid=document.getElementById("postsGrid");

posts.forEach(post=>{
const div=document.createElement("div");
div.classList.add("post-item");
div.innerHTML=`
${post.mediaType==="video"
? `<video src="${post.mediaUrl}" muted></video>`
: `<img src="${post.mediaUrl}">`}
<div class="overlay">❤ ${post.likes?.length||0}</div>
<div class="like-heart">❤</div>
`;

let lastTap=0;
div.addEventListener("click",()=>openModal(post));
div.addEventListener("dblclick",()=>{
likePost(post._id,div);
});

grid.appendChild(div);
});
}

/* DOUBLE TAP LIKE */
async function likePost(postId,element){
await fetch(API+"/api/posts/"+postId+"/like",{method:"PATCH",headers:{Authorization:"Bearer "+token}});
const heart=element.querySelector(".like-heart");
heart.style.opacity="1";
setTimeout(()=>heart.style.opacity="0",600);
}

/* MODAL */
function openModal(post){
document.getElementById("modalBody").innerHTML=
post.mediaType==="video"
? `<video controls src="${post.mediaUrl}"></video>`
: `<img src="${post.mediaUrl}">`;
document.getElementById("modal").style.display="flex";
}
function closeModal(){document.getElementById("modal").style.display="none";}

function toggleFollow(){
fetch(API+"/api/users/"+userId+"/follow",{method:"PATCH",headers:{Authorization:"Bearer "+token}})
.then(()=>location.reload());
}

function messageUser(){
window.location.href="employer.html#message="+userId;
}

loadProfile();
loadPosts();
</script>

</body>
</html>
