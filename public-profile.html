<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Profile | AIFT</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Inter',sans-serif;}
body{background:#f3f2ef;color:#111;}
.container{max-width:1000px;margin:40px auto;padding:0 15px;}
.card{background:white;border-radius:12px;box-shadow:0 4px 15px rgba(0,0,0,0.05);margin-bottom:20px;overflow:hidden;}

/* HEADER */
.banner{width:100%;height:250px;object-fit:cover;background:#ddd;}
.profile-body{padding:25px;position:relative;}
.avatar{
width:160px;height:160px;border-radius:50%;border:5px solid white;
position:absolute;top:-80px;left:30px;object-fit:cover;background:#fff;
}
.profile-info{margin-top:100px;margin-left:200px;}
.profile-info h2{font-size:24px;font-weight:600;}
.profile-info p{color:#6f6f6f;margin:6px 0;}
.role{color:#0a66c2;font-weight:600;}

.stats{display:flex;gap:25px;margin-top:10px;font-size:14px;}
.stats span strong{font-weight:600;color:#000;}

.action-buttons{margin-top:15px;display:flex;gap:10px;}
.btn{padding:8px 18px;border-radius:20px;border:none;font-weight:600;cursor:pointer;font-size:14px;}
.follow-btn{background:#0a66c2;color:white;}
.unfollow-btn{background:#e4e6eb;color:black;}
.message-btn{background:white;border:1px solid #ccc;}

.section{padding:20px;}
.section h3{margin-bottom:15px;}

.skill-tag{
background:#e4e6eb;
padding:6px 12px;
border-radius:20px;
margin:5px;
display:inline-block;
font-size:13px;
}

/* INSTAGRAM GRID */
.posts-wrapper{margin-top:30px;}
.posts-grid{
display:grid;
grid-template-columns:repeat(3,1fr);
gap:8px;
}
.post-item{
position:relative;
width:100%;
padding-top:100%;
overflow:hidden;
cursor:pointer;
border-radius:8px;
}
.post-item img,
.post-item video{
position:absolute;
top:0;left:0;
width:100%;height:100%;
object-fit:cover;
}
.overlay{
position:absolute;
top:0;left:0;
width:100%;height:100%;
background:rgba(0,0,0,0.4);
color:white;
display:flex;
align-items:center;
justify-content:center;
opacity:0;
transition:.3s;
font-weight:600;
}
.post-item:hover .overlay{opacity:1;}

.no-posts{text-align:center;padding:40px;color:#777;}

@media(max-width:768px){
.profile-info{margin-left:0;margin-top:90px;}
.avatar{left:20px;width:130px;height:130px;top:-65px;}
.posts-grid{grid-template-columns:repeat(2,1fr);}
}
</style>
</head>

<body>

<div class="container">

<!-- PROFILE HEADER -->
<div class="card">
<img id="banner" class="banner">

<div class="profile-body">

<img id="avatar" class="avatar">

<div class="profile-info">
<h2 id="name"></h2>
<p id="headline"></p>
<p id="role" class="role"></p>
<p id="bio"></p>

<div class="stats">
<span><strong id="followersCount">0</strong> Followers</span>
<span><strong id="followingCount">0</strong> Following</span>
<span><strong id="postsCount">0</strong> Posts</span>
</div>

<div class="action-buttons">
<button id="followBtn" class="btn follow-btn" onclick="toggleFollow()">Follow</button>
<button class="btn message-btn" onclick="messageUser()">Message</button>
</div>
</div>

</div>
</div>

<!-- EXPERIENCE -->
<div class="card section">
<h3>Experience</h3>
<div id="experienceSection"></div>
</div>

<!-- EDUCATION -->
<div class="card section">
<h3>Education</h3>
<div id="educationSection"></div>
</div>

<!-- SKILLS -->
<div class="card section">
<h3>Skills</h3>
<div id="skillsSection"></div>
</div>

<!-- RESUME -->
<div class="card section">
<h3>Resume</h3>
<a id="cvLink" target="_blank"></a>
</div>

<!-- POSTS GRID -->
<div class="card section posts-wrapper">
<h3>Posts</h3>
<div id="postsGrid" class="posts-grid"></div>
</div>

</div>

<script>
const API="https://backend-1-9b6f.onrender.com";
const token=localStorage.getItem("token");
const params=new URLSearchParams(window.location.search);
const userId=params.get("id");
if(!userId) window.location.href="employer.html";

let loggedUser=null;

/* LOAD PROFILE */
async function loadProfile(){
const res=await fetch(API+"/api/users/"+userId+"/public");
const user=await res.json();

document.getElementById("banner").src=user.bannerImage||"https://via.placeholder.com/1000x250";
document.getElementById("avatar").src=user.profileImage||"https://cdn-icons-png.flaticon.com/512/149/149071.png";
document.getElementById("name").innerText=user.name;
document.getElementById("headline").innerText=user.headline||"";
document.getElementById("bio").innerText=user.bio||"";
document.getElementById("role").innerText=user.role?user.role.toUpperCase():"";

document.getElementById("followersCount").innerText=user.followers?.length||0;
document.getElementById("followingCount").innerText=user.following?.length||0;

/* EXPERIENCE */
const exp=document.getElementById("experienceSection");
exp.innerHTML="";
(user.experience||[]).forEach(e=>{
exp.innerHTML+=`
<div style="margin-bottom:15px;">
<b>${e.title}</b> - ${e.company}<br>
<span style="font-size:13px;color:#6f6f6f;">
${e.startDate} - ${e.endDate||"Present"}
</span>
<div style="margin-top:5px;">${e.description||""}</div>
</div>`;
});

/* EDUCATION */
const edu=document.getElementById("educationSection");
edu.innerHTML="";
(user.education||[]).forEach(e=>{
edu.innerHTML+=`
<div style="margin-bottom:10px;">
<b>${e.school}</b><br>
${e.degree} â€¢ ${e.year}
</div>`;
});

/* SKILLS */
document.getElementById("skillsSection").innerHTML=
(user.skills||[]).map(s=>`<span class="skill-tag">${s}</span>`).join("");

/* CV */
if(user.cvUrl){
document.getElementById("cvLink").href=user.cvUrl;
document.getElementById("cvLink").innerText="View Resume";
}else{
document.getElementById("cvLink").innerText="No resume uploaded";
}

/* GET LOGGED USER */
if(token){
const meRes=await fetch(API+"/api/users/me",{headers:{Authorization:"Bearer "+token}});
loggedUser=await meRes.json();

if(loggedUser._id===userId){
document.getElementById("followBtn").style.display="none";
}else{
updateFollowButton();
}
}
}

/* FOLLOW BUTTON */
async function updateFollowButton(){
if(!loggedUser)return;
const isFollowing=loggedUser.following?.includes(userId);
const btn=document.getElementById("followBtn");
if(isFollowing){
btn.innerText="Following";
btn.classList.remove("follow-btn");
btn.classList.add("unfollow-btn");
}else{
btn.innerText="Follow";
btn.classList.remove("unfollow-btn");
btn.classList.add("follow-btn");
}
}

/* TOGGLE FOLLOW */
async function toggleFollow(){
const res=await fetch(API+"/api/users/"+userId+"/follow",{
method:"PATCH",
headers:{Authorization:"Bearer "+token}
});
if(!res.ok){alert("Follow failed");return;}
const data=await res.json();
document.getElementById("followersCount").innerText=data.followers;
updateFollowButton();
}

/* LOAD POSTS */
async function loadPosts(){
const res=await fetch(API+"/api/posts/user/"+userId,{
headers:{Authorization:"Bearer "+token}
});
const posts=res.ok?await res.json():[];
document.getElementById("postsCount").innerText=posts.length;

const grid=document.getElementById("postsGrid");
grid.innerHTML="";

if(posts.length===0){
grid.innerHTML='<div class="no-posts">No posts yet</div>';
return;
}

posts.forEach(post=>{
const div=document.createElement("div");
div.classList.add("post-item");

div.innerHTML=`
${post.mediaType==="video"
? `<video src="${post.mediaUrl}" muted></video>`
: `<img src="${post.mediaUrl}">`}
<div class="overlay">View</div>
`;

grid.appendChild(div);
});
}

function messageUser(){
window.location.href="employer.html#message="+userId;
}

loadProfile();
loadPosts();
</script>

</body>
</html>
